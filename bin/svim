#! /usr/bin/env bash

# Fail fast
set -o errexit

files=`find -s . -type d \( \
                  -path ./**/obj/* -o \
                  -path ./**/vendor/* -o \
                  -path ./.bundle -o \
                  -path ./.git -o \
                  -path ./.sass-cache -o \
                  -path ./.secrets -o \
                  -path ./.vim/undodir -o \
                  -path ./app/assets/fonts -o \
                  -path ./app/assets/images -o \
                  -path ./artifacts -o \
                  -path ./build -o \
                  -path ./log -o \
                  -path ./node_modules -o \
                  -path ./packages -o \
                  -path ./tmp -o \
                  -path ./tools -o \
                  -path ./vendor \
              \) \
              -prune -o \
              -type f -print | sed -e "s/^\.\///"`

if [ -z "$1" ]; then
  nvim $(echo -e "$files" | selecta)
else
  nvim $(echo -e "$files" | selecta --search "$1")
fi
