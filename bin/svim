#! /usr/bin/env bash

# Fail fast
set -o errexit

files=`find . -type d \( \
                  -path ./.git -o \
                  -path ./.sass-cache -o \
                  -path ./app/assets/fonts -o \
                  -path ./app/assets/images -o \
                  -path ./artifacts -o \
                  -path ./build -o \
                  -path ./log -o \
                  -path ./node_modules -o \
                  -path ./**/obj/* -o \
                  -path ./packages -o \
                  -path ./tmp -o \
                  -path ./tools -o \
                  -path ./vendor -o\
                  -path ./.vim/undodir \
              \) \
              -prune -o \
              -type f -print | sed -e "s/^\.\///"`

if [ -z "$1" ]; then
  mvim -v $(echo -e "$files" | selecta)
else
  mvim -v $(echo -e "$files" | selecta --search "$1")
fi
